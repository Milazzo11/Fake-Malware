#include <iostream>
#include <chrono>
#include <thread>
#include <ctime>
#include <string>
#include <fstream>
#include <windows.h>
// manages imports

using namespace std;


void sleep(double time) {  // stops the program for a certain amount of time

    double timeMultiplier = time * 1000;
    int timeInt = (int) timeMultiplier;

    chrono::milliseconds timespan(timeInt);
    this_thread::sleep_for(timespan);
}


string getUTC() {  // returns UTC time as a string

    time_t now = time(nullptr);
    tm *gmtm = gmtime(&now);
    string dt = asctime(gmtm);

    return dt;
}


void loadBar(int count, double interval) {  // creates a loading bar

    for (int i = 0; i < count; i++) {
        cout << ".";
        sleep(interval);
    }
}


void loadPercentage(double rate, int end) {  // writes loading percentages

    for (int i = 1; i <= end; i++) {
        cout << "\n> " << i * 10 << "%";
        sleep(rate);
    }
}


bool runProgram() {  // checks if main systems should run

    ifstream infile("data.txt");
    string data = "A";

    if (infile.good())
        getline(infile, data);

    infile.close();

    if (data.empty()) {
        ofstream writefile("data.txt");
        writefile << "B";

        return true;
    }

    return false;
}


int main() {

    if (runProgram()) {  // prints "virus" messages
        system("Color 4");
        cout << "Windows Critical System Error >>>";

        sleep(1);
        cout << "\n\nWindows Security- Threat Detected: Trojan:Win32/Wacatac.G!ml";

        sleep(0.7);
        string dt = getUTC();
        cout << "\nTime: " << dt;

        sleep(0.6);
        cout << "Alert Level: Severe";

        sleep(0.7);
        cout << "\nCategory: Trojan";

        sleep(1);
        cout << "\n" << R"(File: C:\Users\Public\tgpbit.exe)" << "\n\n\n";

        sleep(1);
        system("Color 1");
        cout << "SYSTEM DEFENSE PROTOCOL INITIATED\n";
        loadBar(30, 0.1);

        sleep(0.5);
        cout << "\nRemoving File:";
        sleep(0.7);
        loadPercentage(0.3, 9);

        sleep(1);
        cout << "\n.";

        loadBar(7, 0.3);

        sleep(0.5);
        MessageBox(nullptr, "ERROR: 000xff69 - COULD NOT REMOVE FILE\nVisit Microsoft.com/winerrors for more details.", "ERROR", MB_ICONEXCLAMATION);
        // shows a message box

        system(R"(C:\WINDOWS\System32\shutdown /s)");
        //shuts down machine
    }

    return 0;
}